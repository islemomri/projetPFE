<p-toast></p-toast>
<div class="admin-container">
    <p-card [style]="{ width: '40rem', 'margin-top': '2rem' }" >
      <ng-template #header>
        <div class="flex align-items-center justify-content-between">
          <h2>Ajouter un nouvel utilisateur</h2>
        </div>
      </ng-template>
      
      <form [formGroup]="registerForm" (ngSubmit)="submitForm()" class="form-grid">
        <!-- Nom et Prénom sur la même ligne -->
        <div class="field col-6">
          <p-floatlabel>
            <input pInputText id="nom" formControlName="nom" class="w-full" />
            <label for="nom">Nom <span class="required">*</span></label>
          </p-floatlabel>
          <small class="p-error block mt-1" *ngIf="registerForm.controls['nom'].invalid && registerForm.controls['nom'].touched">
            <i class="pi pi-exclamation-circle mr-1" style="margin-top: 5px;"></i> Ce champ est obligatoire
          </small>
        </div>
  
        <div class="field col-6">
          <p-floatlabel>
            <input pInputText id="prenom" formControlName="prenom" class="w-full" />
            <label for="prenom">Prénom <span class="required">*</span></label>
          </p-floatlabel>
          <small class="p-error block mt-1" *ngIf="registerForm.controls['prenom'].invalid && registerForm.controls['prenom'].touched">
            <i class="pi pi-exclamation-circle mr-1" style="margin-top: 5px;"></i> Ce champ est obligatoire
          </small>
        </div>
  
        <!-- Nom d'utilisateur -->
        <div class="field col-6">
          <p-floatlabel>
            <input pInputText id="username" formControlName="username" class="w-full" />
            <label for="username">Nom d'utilisateur <span class="required">*</span></label>
          </p-floatlabel>
          <small class="p-error block mt-1" *ngIf="registerForm.controls['username'].invalid && registerForm.controls['username'].touched">
            <i class="pi pi-exclamation-circle mr-1" style="margin-top: 5px;"></i> Ce champ est obligatoire
          </small>
        </div>
  
        <!-- Email -->
        <div class="field col-6">
          <p-floatlabel>
            <input pInputText type="email" id="email" formControlName="email" class="w-full" />
            <label for="email">Email</label>
          </p-floatlabel>
          <small class="p-error block mt-1" *ngIf="registerForm.controls['email'].invalid && registerForm.controls['email'].touched">
            <i class="pi pi-exclamation-circle mr-1" style="margin-top: 5px;"></i> Format d'email invalide
          </small>
        </div>
  
        <!-- Mot de passe et confirmation -->
        <div class="field col-6">
          <p-floatlabel>
            <p-password id="password" formControlName="password" [toggleMask]="true" [feedback]="true" class="w-full" 
                       [inputStyleClass]="'w-full'"></p-password>
            <label for="password">Mot de passe <span class="required">*</span></label>
          </p-floatlabel>
          <small class="p-error block mt-1" *ngIf="registerForm.controls['password'].invalid && registerForm.controls['password'].touched">
            <i class="pi pi-exclamation-circle mr-1" style="margin-top: 5px;"></i> Minimum 8 caractères
          </small>
        </div>
  
        <div class="field col-6">
          <p-floatlabel>
            <p-password id="confirmPassword" formControlName="confirmPassword" [toggleMask]="true" class="w-full" 
                         [inputStyleClass]="'w-full'"></p-password>
            <label for="confirmPassword">Confirmation <span class="required">*</span></label>
          </p-floatlabel>
          <small class="p-error block mt-1" *ngIf="registerForm.controls['confirmPassword'].invalid && registerForm.controls['confirmPassword'].touched">
            <i class="pi pi-exclamation-circle mr-1" style="margin-top: 5px;"></i> Les mots de passe ne correspondent pas
          </small>
        </div>
  
        <!-- Sélection du rôle (visible seulement pour admin) -->
        <div *ngIf="isAdmin()" class="field col-12">
          <label class="block mb-2 font-medium">Rôle <span class="required">*</span></label>
          <p-dropdown [options]="roleOptions" formControlName="role" placeholder="Sélectionner un rôle"
                     optionLabel="label" optionValue="value" class="w-full">
            <ng-template pTemplate="selectedicon">
              <i class="pi pi-briefcase mr-2"></i>
            </ng-template>
            <ng-template let-option pTemplate="item">
              <div class="flex align-items-center">
                <i [class]="'mr-2 '"></i>
                <span>{{option.label}}</span>
              </div>
            </ng-template>
          </p-dropdown>
        </div>
  
        <div class="field col-12 mt-4">
          <p-button type="submit" label="Créer l'utilisateur" icon="pi pi-check" class="w-full" 
                   [disabled]="registerForm.invalid" severity="success"></p-button>
        </div>
      </form>
      
      <ng-template #footer>
        <small class="text-color-secondary">Seuls les administrateurs peuvent créer de nouveaux utilisateurs</small>
      </ng-template>
    </p-card>
  </div>