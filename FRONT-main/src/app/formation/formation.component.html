<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Gestion des Formations | Plateforme RH</title>
  <style>
    /* Styles globaux améliorés */
 body {
   background-color: #f5f7fa;
   color: #2d3748;
   margin: 0;
   padding: 20px;
 }
 
 /* En-tête modernisé - Thème gris clair avec accents bleus */
 .app-header {
   display: flex;
   justify-content: space-between;
   align-items: center;
   background: linear-gradient(135deg, #f1f5f9 0%, #e2e8f0 100%);
   color: #334155;
   padding: 1rem 2rem;
   border-radius: 10px;
   margin-bottom: 2rem;
   box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05);
   border: 1px solid #e2e8f0;
 }
 
 .app-title {
   display: flex;
   align-items: center;
   font-size: 1.5rem;
   font-weight: 600;
 }
 
 .app-title i {
   margin-right: 10px;
   font-size: 1.8rem;
   color: #2563eb; /* Bleu accent */
 }
 
 .header-actions {
   display: flex;
   gap: 15px;
 }
 
 /* Boutons avec accents bleus */
 .p-button-primary {
   background-color: #2563eb; /* Bleu vif */
   border-color: #2563eb;
 }
 .p-button-primary:hover {
   background-color: #1d4ed8;
   border-color: #1d4ed8;
 }
 
 .p-button-help {
   background-color: #3b82f6; /* Bleu moyen */
   border-color: #3b82f6;
 }
 .p-button-help:hover {
   background-color: #2563eb;
   border-color: #2563eb;
 }
 
 /* Conteneur principal avec bordure bleue subtile */
 .main-container {
   background: white;
   border-radius: 10px;
   box-shadow: 0 1px 3px rgba(0, 0, 0, 0.05);
   padding: 1.5rem;
   margin-bottom: 2rem;
   border: 1px solid #e2e8f0;
   border-top: 3px solid #3b82f6; /* Ligne bleue en haut */
 }
 
 /* Onglets améliorés avec indicateur bleu */
 .custom-tabview .p-tabview-nav {
   border-radius: 8px 8px 0 0;
   background: #f8fafc;
   border-color: #e2e8f0;
 }
 
 .custom-tabview .p-tabview-nav li .p-tabview-nav-link {
   transition: all 0.3s;
 }
 
 .custom-tabview .p-tabview-nav li.p-highlight .p-tabview-nav-link {
   color: #2563eb;
   border-color: #2563eb;
 }
 
 .custom-tabview .p-tabview-panels {
   border-radius: 0 0 8px 8px;
   padding: 1.5rem;
   background: white;
   border: 1px solid #e2e8f0;
   border-top: none;
 }
 
 /* Tableaux modernisés avec accents bleus */
 .enhanced-table {
   border: 1px solid #e2e8f0;
   border-radius: 8px;
   overflow: hidden;
 }
 
 .table-header {
   display: flex;
   justify-content: space-between;
   align-items: center;
   padding: 1rem;
   background: #f8fafc;
   border-bottom: 1px solid #e2e8f0;
 }
 
 .search-box {
   position: relative;
   width: 300px;
 }
 
 .search-box i {
   position: absolute;
   left: 12px;
   top: 50%;
   transform: translateY(-50%);
   color: #64748b;
 }
 
 .search-box input {
   width: 100%;
   padding: 0.5rem 1rem 0.5rem 2.5rem;
   border-radius: 20px;
   border: 1px solid #e2e8f0;
   transition: all 0.3s;
   background-color: #f8fafc;
 }
 
 .search-box input:focus {
   outline: none;
   border-color: #3b82f6; /* Bleu pour le focus */
   box-shadow: 0 0 0 2px rgba(59, 130, 246, 0.2);
 }
 
 .table-info {
   font-size: 0.875rem;
   color: #64748b;
 }
 
 /* Lignes de tableau améliorées avec effets bleus */
 .formation-row td {
   vertical-align: top;
   padding: 1rem 0.75rem;
   border-bottom: 1px solid #f1f5f9;
 }
 
 .formation-title {
   font-weight: 600;
   color: #1e293b;
   margin-bottom: 0.25rem;
 }
 
 .formation-title:hover {
   color: #2563eb; /* Bleu au survol */
 }
 
 .formation-description {
   font-size: 0.875rem;
   color: #64748b;
   display: -webkit-box;
   -webkit-line-clamp: 2;
   -webkit-box-orient: vertical;
   overflow: hidden;
 }
 
 .formation-type {
   font-weight: 500;
   color: #475569;
 }
 
 .formation-subtype {
   font-size: 0.875rem;
   color: #94a3b8;
 }
 
 .date-range {
   font-size: 0.875rem;
 }
 
 .date-label {
   font-size: 0.75rem;
   color: #94a3b8;
   display: block;
 }
 
 /* Badges modernes avec bleu */
 .status-badge {
   font-weight: 600;
   padding: 0.35rem 0.75rem;
   border-radius: 20px;
   font-size: 0.875rem;
 }
 
 .participants-badge {
   display: inline-flex;
   align-items: center;
   justify-content: center;
   background: #dbeafe; /* Fond bleu très clair */
   color: #2563eb; /* Texte bleu */
   border-radius: 50%;
   width: 26px;
   height: 26px;
   font-size: 0.75rem;
   font-weight: 600;
   margin-left: 0.5rem;
 }
 
 /* Boutons d'action avec bleu */
 .action-buttons {
   display: flex;
   gap: 8px;
 }
 
 .action-btn {
   width: 36px;
   height: 36px;
   display: flex;
   align-items: center;
   justify-content: center;
   border-radius: 50%;
   transition: all 0.2s;
   background-color: #f1f5f9;
   color: #64748b;
   border: none;
 }
 
 .action-btn:hover {
   transform: translateY(-2px);
   background-color: #dbeafe; /* Bleu très clair */
   color: #2563eb; /* Icône bleue */
 }
 
 /* Message vide stylisé */
 .empty-message {
   text-align: center;
   padding: 3rem;
   color: #64748b;
 }
 
 .empty-message i {
   font-size: 3rem;
   color: #cbd5e1;
   margin-bottom: 1rem;
   display: block;
 }
 
 /* Dialogues modernisés avec accents bleus */
 .modern-dialog .p-dialog-header {
   background: linear-gradient(135deg, #f1f5f9 0%, #e2e8f0 100%);
   color: #334155;
   border-top-left-radius: 10px;
   border-top-right-radius: 10px;
   border-bottom: 1px solid #e2e8f0;
 }
 
 .modern-dialog .p-dialog-header i {
   color: #2563eb; /* Icône bleue */
 }
 
 .dialog-content {
   padding: 1.5rem;
 }
 
 .form-row {
   display: flex;
   gap: 20px;
   margin-bottom: 1.5rem;
 }
 
 .form-group {
   flex: 1;
 }
 
 /* Style du dialogue participants */
 .participants-dialog .p-dialog-header {
   background: linear-gradient(135deg, #f1f5f9 0%, #e2e8f0 100%);
   color: #334155;
   border-top-left-radius: 12px;
   border-top-right-radius: 12px;
 }
 
 /* Styles spécifiques pour votre structure existante */
 .date-container {
   display: flex;
   gap: 20px;
 }
 
 .date-container .p-field {
   flex: 1;
 }
 
 .radio-group {
   display: flex;
   gap: 10px;
   align-items: center;
 }
 
 .resultat-container {
   display: flex;
   align-items: center;
   gap: 10px;
 }
 
 .selected-employees {
   margin-top: 1rem;
   border: 1px solid #e2e8f0;
   border-radius: 8px;
   padding: 1rem;
   background-color: #f8fafc;
 }
 
 .employee-item {
   display: flex;
   justify-content: space-between;
   align-items: center;
   padding: 0.5rem 0;
   border-bottom: 1px solid #f1f5f9;
 }
 
 .employee-item:last-child {
   border-bottom: none;
 }
 
 /* Styles pour les participants */
 .participant-info {
   display: flex;
   align-items: center;
   gap: 12px;
 }
 
 .participant-avatar {
   width: 40px;
   height: 40px;
   border-radius: 50%;
   background: #dbeafe; /* Fond bleu très clair */
   color: #2563eb; /* Texte bleu */
   display: flex;
   align-items: center;
   justify-content: center;
   font-weight: 600;
   flex-shrink: 0;
 }
 
 .participant-details {
   display: flex;
   flex-direction: column;
 }
 
 .participant-name {
   font-weight: 600;
   color: #1e293b;
 }
 
 .participant-name:hover {
   color: #2563eb; /* Bleu au survol */
 }
 
 .participant-meta {
   display: flex;
   gap: 8px;
   font-size: 0.75rem;
   color: #64748b;
 }
 
 .meta-item {
   display: flex;
   align-items: center;
   gap: 4px;
 }
 
 /* Style des badges */
 .matricule-badge {
   background: #dbeafe; /* Fond bleu très clair */
   padding: 4px 8px;
   border-radius: 4px;
   font-family: monospace;
   font-size: 0.9rem;
   color: #2563eb; /* Texte bleu */
 }
 
 /* Style des liens email */
 .email-link {
   color: #64748b;
   text-decoration: none;
   display: flex;
   align-items: center;
   gap: 6px;
 }
 
 .email-link:hover {
   color: #2563eb; /* Bleu au survol */
   text-decoration: underline;
 }
 
 .email-link i {
   color: #3b82f6; /* Icône bleue */
 }
 
 /* Style des documents */
 .document-container {
   display: flex;
   align-items: center;
   gap: 8px;
 }
 
 .document-status {
   font-size: 0.875rem;
 }
 
 .document-status.success {
   color: #10b981;
 }
 
 .document-status.error {
   color: #ef4444;
 }
 /* Styles pour les deux dialogues */
 .dialog-content {
     padding: 1rem;
 }
 
 .p-field {
     margin-bottom: 1.5rem;
 }
 
 label {
     display: block;
     margin-bottom: 0.5rem;
     font-weight: 500;
     color: #495057;
 }
 
 .p-inputtext, .p-dropdown, .p-calendar, .p-multiselect, .p-inputtextarea {
     width: 100%;
 }
 
 .p-error {
     color: #f44336;
     font-size: 0.85rem;
     margin-top: 0.25rem;
     display: block;
 }
 
 .date-container {
     display: flex;
     gap: 1rem;
 }
 
 .date-container > .p-field {
     flex: 1;
 }
 
 .selected-employees {
     margin-top: 1rem;
     padding: 1rem;
     background: #f8f9fa;
     border-radius: 4px;
 }
 
 .employee-item {
     display: flex;
     justify-content: space-between;
     align-items: center;
     padding: 0.5rem 0;
     border-bottom: 1px solid #dee2e6;
 }
 
 .radio-group {
     display: flex;
     gap: 1rem;
 }
 
 .radio-group label {
     display: flex;
     align-items: center;
     gap: 0.5rem;
     font-weight: normal;
     cursor: pointer;
 }
 
 .p-dialog .p-dialog-footer {
     display: flex;
     justify-content: flex-end;
     gap: 0.5rem;
     padding: 1rem;
     border-top: 1px solid #dee2e6;
 }
 
 /* Style spécifique pour les iframe PDF */
 .pdf-viewer {
     width: 100%;
     height: 400px;
     border: 1px solid #dee2e6;
     border-radius: 4px;
     margin-top: 0.5rem;
 }
 
 /* Style de l'évaluation */
 .evaluation-form {
   padding: 8px 0;
 }
 
 .radio-options {
   display: flex;
   flex-direction: column;
   gap: 8px;
 }
 
 .radio-option {
   display: flex;
   align-items: center;
 }
 
 .evaluation-result {
   display: flex;
   align-items: center;
   gap: 12px;
 }
 
 .result-tag {
   font-weight: 600;
   padding: 0.35rem 0.75rem;
 }
 
 .edit-btn {
   color: #64748b;
 }
 
 .edit-btn:hover {
   color: #2563eb; /* Bleu au survol */
 }
 
 /* État vide */
 .empty-state {
   text-align: center;
   padding: 2rem;
   color: #64748b;
 }
 
 .empty-state i {
   margin-bottom: 1rem;
   color: #cbd5e1;
   font-size: 2rem;
 }
 
 .empty-state p {
   margin-top: 0.5rem;
 }
 
 /* Calendrier */
 .fc-event {
   background-color: #3b82f6 !important; /* Bleu pour les événements */
   border-color: #3b82f6 !important;
 }
 
 .fc-event:hover {
   background-color: #2563eb !important;
 }
 
 /* Dropdowns avec accent bleu */
 .p-dropdown:not(.p-disabled).p-focus {
   box-shadow: 0 0 0 2px rgba(59, 130, 246, 0.2);
   border-color: #3b82f6;
 }
 
 .p-dropdown-panel .p-dropdown-items .p-dropdown-item.p-highlight {
   background: #dbeafe;
   color: #2563eb;
 }
 
 /* Checkbox et Radio avec accent bleu */
 .p-checkbox .p-checkbox-box.p-highlight {
   background: #3b82f6;
   border-color: #3b82f6;
 }
 
 .p-radiobutton .p-radiobutton-box.p-highlight {
   background: #3b82f6;
   border-color: #3b82f6;
 }
 
 .p-radiobutton .p-radiobutton-box.p-highlight:not(.p-disabled):hover {
   background: #3b82f6;
   border-color: #3b82f6;
 }
 
 /* Onglets avec indicateur bleu */
 .p-tabview .p-tabview-nav li.p-highlight .p-tabview-nav-link {
   color: #2563eb;
   border-color: #2563eb;
 }
 
 /* Responsive */
 @media (max-width: 768px) {
   .app-header {
     flex-direction: column;
     align-items: flex-start;
     gap: 1rem;
   }
   
   .header-actions {
     width: 100%;
     justify-content: space-between;
   }
   
   .form-row {
     flex-direction: column;
     gap: 1rem;
   }
   
   .search-box {
     width: 100%;
   }
 }
 
 @media (max-width: 992px) {
   .participants-dialog .p-dialog {
     width: 90vw !important;
   }
 }
 
 /* Animation pour les interactions */
 @keyframes pulse {
   0% { box-shadow: 0 0 0 0 rgba(59, 130, 246, 0.4); }
   70% { box-shadow: 0 0 0 10px rgba(59, 130, 246, 0); }
   100% { box-shadow: 0 0 0 0 rgba(59, 130, 246, 0); }
 }
 
 .pulse-effect {
   animation: pulse 1.5s infinite;
 }
 
 /* Effet de vague au survol pour les boutons */
 .wave-effect {
   position: relative;
   overflow: hidden;
 }
 
 .wave-effect:after {
   content: "";
   display: block;
   position: absolute;
   width: 100%;
   height: 100%;
   top: 0;
   left: 0;
   pointer-events: none;
   background-image: radial-gradient(circle, #3b82f6 10%, transparent 10.01%);
   background-repeat: no-repeat;
   background-position: 50%;
   transform: scale(10, 10);
   opacity: 0;
   transition: transform .5s, opacity 1s;
 }
 
 .wave-effect:active:after {
   transform: scale(0, 0);
   opacity: .3;
   transition: 0s;
 }
 
 
 
 
   </style>
</head>
<body>

<!-- En-tête modernisé -->
<div class="app-header">
  <div class="app-title">
    <i class="pi pi-book"></i>
    <span>Gestion des Formations</span>
  </div>
  <div class="header-actions">
    <button pButton type="button" label="Nouvelle Formation" icon="pi pi-plus" 
            (click)="openDialog()" class="p-button-raised p-button-primary"></button>
    <button pButton type="button" icon="pi pi-calendar" 
            (click)="openCalendarDialog()" 
            class="p-button-rounded p-button-help"
            pTooltip="Vue calendrier" tooltipPosition="bottom"></button>
  </div>
</div>

<!-- Conteneur principal -->
<div class="main-container">
  <p-card header="Liste des Formations" [style]="{ 'border-radius': '10px' }" class="p-shadow-3">
    <p-tabView class="custom-tabview">
      
      <!-- Dialogue Détails de la formation -->
      <p-dialog
        header="Détails de la formation"
        [(visible)]="displayEventDialog"
        [modal]="true"
        [style]="{ width: '450px' }"
        [draggable]="false"
        [resizable]="false"
        class="modern-dialog"
      >
        <div class="dialog-content" *ngIf="selectedEvent">
          <p><strong>Titre :</strong> {{ selectedEvent.title }}</p>
          <p><strong>Début :</strong> {{ selectedEvent.start | date: 'dd/MM/yyyy HH:mm' }}</p>
          <p><strong>Fin :</strong> {{ selectedEvent.end | date: 'dd/MM/yyyy HH:mm' }}</p>
        </div>
        <ng-template pTemplate="footer">
          <button
            pButton
            type="button"
            label="Fermer"
            (click)="displayEventDialog = false"
            class="p-button-text"
          ></button>
        </ng-template>
      </p-dialog>

      <!-- Onglet Formations en Attente -->
      <p-tabPanel header="En Attente" leftIcon="pi pi-clock">
        <div class="enhanced-table">
          <p-table
            #dt1
            [value]="formationsNonValidees"
            [globalFilterFields]="['titre', 'description', 'typeFormation', 'sousTypeFormation', 'responsableEvaluationExterne']"
            selectionMode="single"
            [(selection)]="selectedFormation"
            dataKey="id"
            [rows]="10"
            [paginator]="true"
            stateStorage="session"
            stateKey="statedemo-session"
            styleClass="p-datatable-striped p-datatable-gridlines"
          >
            <ng-template pTemplate="caption">
              <div class="table-header">
                <div class="search-box">
                  <i class="pi pi-search"></i>
                  <input
                    pInputText
                    type="text"
                    (input)="dt1.filterGlobal($any($event.target).value, 'contains')"
                    placeholder="Rechercher une formation..."
                  />
                </div>
                <div class="table-info">
                  {{formationsNonValidees.length || 0}} formations en attente
                </div>
              </div>
            </ng-template>
            
            <ng-template pTemplate="header">
              <tr>
                <th pSortableColumn="titre" style="width:22%">Titre <p-sortIcon field="titre" /></th>
                <th pSortableColumn="typeFormation" style="width:15%">Type <p-sortIcon field="typeFormation" /></th>
                <th style="width:15%">Dates</th>
                <th pSortableColumn="responsableEvaluation" style="width:15%">Responsable <p-sortIcon field="responsableEvaluation" /></th>
                <th style="width:10%">Participants</th>
                <th style="width:10%">Statut</th>
                <th style="width:8%">Validation</th>
                <th style="width:5%">Actions</th>
              </tr>
            </ng-template>
            
            <ng-template pTemplate="body" let-formation>
              <tr class="formation-row">
                <td>
                  <div class="formation-title">{{ formation.titre }}</div>
                  <div class="formation-description">{{ formation.description }}</div>
                </td>
                <td>
                  <div class="formation-type">{{ formation.typeFormation }}</div>
                  <div class="formation-subtype">{{ formation.sousTypeFormation }}</div>
                </td>
                <td>
                  <div class="date-range">
                    <span class="date-label">Début:</span> 
                    {{ formation.dateDebutPrevue | date: 'dd/MM/yyyy' }}
                  </div>
                  <div class="date-range">
                    <span class="date-label">Fin:</span> 
                    {{ formation.dateFinPrevue | date: 'dd/MM/yyyy' }}
                  </div>
                </td>
                <td>{{ formation.responsableEvaluation?.nom || formation.responsableEvaluationExterne || 'N/A' }}</td>
                <td class="text-center">
                  <button pButton icon="pi pi-users" 
                          (click)="showParticipants(formation)"
                          class="p-button-rounded p-button-text p-button-plain action-btn"
                          pTooltip="Voir participants" tooltipPosition="top"></button>
                  <span class="participants-badge">{{formation.employes?.length || 0}}</span>
                </td>
                <td>
                  <p-tag [severity]="getStatusSeverity(formation.dateFinPrevue)" 
                         [value]="getFormationStatus(formation.dateFinPrevue)"
                         styleClass="status-badge"></p-tag>
                </td>
                <td>
                  <p-tag severity="warn" icon="pi pi-clock" value="En attente" styleClass="status-badge"></p-tag>
                </td>
                <td class="action-buttons">
                  <button pButton icon="pi pi-pencil" 
                          (click)="openModificationDialog(formation)"
                          class="p-button-rounded p-button-text p-button-plain action-btn"
                          pTooltip="Modifier" tooltipPosition="top"></button>
                </td>
              </tr>
            </ng-template>
            
            <ng-template pTemplate="emptymessage">
              <tr>
                <td colspan="8">
                  <div class="empty-message">
                    <i class="pi pi-inbox"></i>
                    <p>Aucune formation en attente trouvée</p>
                  </div>
                </td>
              </tr>
            </ng-template>
          </p-table>
        </div>
      </p-tabPanel>

      <!-- Onglet Formations Validées -->
      <p-tabPanel header="Validées" leftIcon="pi pi-check-circle">
        <div class="enhanced-table">
          <p-table
            #dt2
            [value]="formationsValidees"
            [globalFilterFields]="['titre', 'description', 'typeFormation', 'sousTypeFormation', 'responsableEvaluationExterne']"
            selectionMode="single"
            [(selection)]="selectedFormation"
            dataKey="id"
            [rows]="10"
            [paginator]="true"
            stateStorage="session"
            stateKey="statedemo-session"
            styleClass="p-datatable-striped p-datatable-gridlines"
          >
            <ng-template pTemplate="caption">
              <div class="table-header">
                <div class="search-box">
                  <i class="pi pi-search"></i>
                  <input
                    pInputText
                    type="text"
                    (input)="dt2.filterGlobal($any($event.target).value, 'contains')"
                    placeholder="Rechercher une formation..."
                  />
                </div>
                <div class="table-info">
                  {{formationsValidees.length || 0}} formations validées
                </div>
              </div>
            </ng-template>
            
            <ng-template pTemplate="header">
              <tr>
                <th pSortableColumn="titre" style="width:22%">Titre <p-sortIcon field="titre" /></th>
                <th pSortableColumn="typeFormation" style="width:15%">Type <p-sortIcon field="typeFormation" /></th>
                <th style="width:15%">Dates</th>
                <th pSortableColumn="responsableEvaluation" style="width:15%">Responsable <p-sortIcon field="responsableEvaluation" /></th>
                <th style="width:10%">Participants</th>
                <th style="width:10%">Statut</th>
                <th style="width:8%">Validation</th>
              </tr>
            </ng-template>
            
            <ng-template pTemplate="body" let-formation>
              <tr class="formation-row">
                <td>
                  <div class="formation-title">{{ formation.titre }}</div>
                  <div class="formation-description">{{ formation.description }}</div>
                </td>
                <td>
                  <div class="formation-type">{{ formation.typeFormation }}</div>
                  <div class="formation-subtype">{{ formation.sousTypeFormation }}</div>
                </td>
                <td>
                  <div class="date-range">
                    <span class="date-label">Début:</span> 
                    {{ formation.dateDebutPrevue | date: 'dd/MM/yyyy' }}
                  </div>
                  <div class="date-range">
                    <span class="date-label">Fin:</span> 
                    {{ formation.dateFinPrevue | date: 'dd/MM/yyyy' }}
                  </div>
                </td>
                <td>{{ formation.responsableEvaluation?.nom || formation.responsableEvaluationExterne || 'N/A' }}</td>
                <td class="text-center">
                  <button pButton icon="pi pi-users" 
                          (click)="showParticipants(formation)"
                          class="p-button-rounded p-button-text p-button-plain action-btn"
                          pTooltip="Voir participants" tooltipPosition="top"></button>
                  <span class="participants-badge">{{formation.employes?.length || 0}}</span>
                </td>
                <td>
                  <p-tag [severity]="getStatusSeverity(formation.dateFinPrevue)" 
                         [value]="getFormationStatus(formation.dateFinPrevue)"
                         styleClass="status-badge"></p-tag>
                </td>
                <td>
                  <p-tag severity="success" icon="pi pi-check" value="Validée" styleClass="status-badge"></p-tag>
                </td>
              </tr>
            </ng-template>
            
            <ng-template pTemplate="emptymessage">
              <tr>
                <td colspan="7">
                  <div class="empty-message">
                    <i class="pi pi-inbox"></i>
                    <p>Aucune formation validée trouvée</p>
                  </div>
                </td>
              </tr>
            </ng-template>
          </p-table>
        </div>
      </p-tabPanel>

      <!-- Onglet Formations Polycompétences -->
      <p-tabPanel header="Polycompétences" leftIcon="pi pi-star">
        <div class="enhanced-table">
          <p-table
            #dt3
            [value]="formationsCompletes"
            [globalFilterFields]="['titre', 'description', 'typeFormation', 'sousTypeFormation', 'responsableEvaluationExterne']"
            selectionMode="single"
            [(selection)]="selectedFormation"
            dataKey="id"
            [rows]="10"
            [paginator]="true"
            stateStorage="session"
            stateKey="statedemo-session"
            styleClass="p-datatable-striped p-datatable-gridlines"
          >
            <ng-template pTemplate="caption">
              <div class="table-header">
                <div class="search-box">
                  <i class="pi pi-search"></i>
                  <input
                    pInputText
                    type="text"
                    (input)="dt3.filterGlobal($any($event.target).value, 'contains')"
                    placeholder="Rechercher une formation..."
                  />
                </div>
                <div class="table-info">
                  {{formationsCompletes.length || 0}} formations complètes
                </div>
              </div>
            </ng-template>
            
            <ng-template pTemplate="header">
              <tr>
                <th pSortableColumn="titre" style="width:22%">Titre <p-sortIcon field="titre" /></th>
                <th pSortableColumn="typeFormation" style="width:15%">Type <p-sortIcon field="typeFormation" /></th>
                <th style="width:15%">Dates</th>
                <th pSortableColumn="responsableEvaluation" style="width:15%">Responsable <p-sortIcon field="responsableEvaluation" /></th>
                <th style="width:10%">Participants</th>
                <th style="width:10%">Statut</th>
                <th style="width:8%">Validation</th>
              </tr>
            </ng-template>
            
            <ng-template pTemplate="body" let-formation>
              <tr class="formation-row">
                <td>
                  <div class="formation-title">{{ formation.titre }}</div>
                  <div class="formation-description">{{ formation.description }}</div>
                </td>
                <td>
                  <div class="formation-type">{{ formation.typeFormation }}</div>
                  <div class="formation-subtype">{{ formation.sousTypeFormation }}</div>
                </td>
                <td>
                  <div class="date-range">
                    <span class="date-label">Début:</span> 
                    {{ formation.dateDebutPrevue | date: 'dd/MM/yyyy' }}
                  </div>
                  <div class="date-range">
                    <span class="date-label">Fin:</span> 
                    {{ formation.dateFinPrevue | date: 'dd/MM/yyyy' }}
                  </div>
                </td>
                <td>{{ formation.responsableEvaluation?.nom || formation.responsableEvaluationExterne || 'N/A' }}</td>
                <td class="text-center">
                  <button pButton icon="pi pi-users" 
                          (click)="showParticipants(formation)"
                          class="p-button-rounded p-button-text p-button-plain action-btn"
                          pTooltip="Voir participants" tooltipPosition="top"></button>
                  <span class="participants-badge">{{formation.employes?.length || 0}}</span>
                </td>
                <td>
                  <p-tag [severity]="getStatusSeverity(formation.dateFinPrevue)" 
                         [value]="getFormationStatus(formation.dateFinPrevue)"
                         styleClass="status-badge"></p-tag>
                </td>
                <td>
                  <p-tag severity="success" icon="pi pi-star" value="Complète" styleClass="status-badge"></p-tag>
                </td>
<td>
  <button pButton icon="pi pi-pencil" 
  (click)="openModificationDialog(formation)"
  class="p-button-rounded p-button-text p-button-plain action-btn"
  pTooltip="Modifier" tooltipPosition="top"></button>

              </td>

              </tr>
            </ng-template>
            
            <ng-template pTemplate="emptymessage">
              <tr>
                <td colspan="7">
                  <div class="empty-message">
                    <i class="pi pi-inbox"></i>
                    <p>Aucune formation complète trouvée</p>
                  </div>
                </td>
              </tr>
            </ng-template>
          </p-table>
        </div>
      </p-tabPanel>
    </p-tabView>
  </p-card>
</div>

<!-- Dialogue Calendrier modernisé -->
<p-dialog header="Calendrier des Formations" [(visible)]="displayCalendarDialog" [modal]="true" 
          [style]="{ width: '85vw', height: '85vh' }" [draggable]="false" [resizable]="false"
          class="modern-dialog">
  <div class="dialog-content">
    <full-calendar [options]="calendarOptions"></full-calendar>
  </div>
  <ng-template pTemplate="footer">
    <button pButton label="Fermer" (click)="displayCalendarDialog = false" 
            class="p-button-text"></button>
  </ng-template>
</p-dialog>

<!-- Dialogue Participants modernisé -->
<p-dialog header="Liste des Participants" [(visible)]="displayDialog" [modal]="true" [closable]="true" 
          [style]="{ width: '70vw' }" class="participants-dialog">
  <div class="dialog-content">
    <p-table *ngIf="selectedFormation?.employes" [value]="selectedFormation.employes" [rows]="8" [paginator]="true"
             styleClass="p-datatable-gridlines p-datatable-striped">
      <ng-template pTemplate="header">
        <tr>
          <th style="min-width: 180px;">Participant</th>
          <th style="width: 120px;">Matricule</th>
          <th>Email</th>
          <th *ngIf="selectedFormation.valide" style="width: 200px;">Document</th>
          <th *ngIf="selectedFormation.valide" style="width: 250px;">Évaluation</th>
        </tr>
      </ng-template>
      <ng-template pTemplate="body" let-employe>
        <tr>
          <!-- Colonne Participant -->
          <td>
            <div class="participant-info">
              <div class="participant-avatar">
                {{ employe.prenom.charAt(0) }}{{ employe.nom.charAt(0) }}
              </div>
              <div class="participant-details">
                <div class="participant-name">{{ employe.prenom }} {{ employe.nom }}</div>
                <div class="participant-meta">
                 
                </div>
              </div>
            </div>
          </td>
          
          <!-- Colonne Matricule -->
          <td>
            <span class="matricule-badge">{{ employe.matricule }}</span>
          </td>
          
          <!-- Colonne Email -->
          <td>
            <a href="mailto:{{ employe.email }}" class="email-link">
              <i class="pi pi-envelope"></i> {{ employe.email }}
            </a>
          </td>
          
          <!-- Colonne Document (si formation validée) -->
          <td *ngIf="selectedFormation.valide">
            <div *ngIf="pdfUrls[employe.id]" class="document-container">
              <button pButton icon="pi pi-file-pdf" 
              (click)="openPdfDialog(pdfUrls[employe.id])"
              class="p-button-rounded p-button-outlined p-button-danger"
              pTooltip="Voir le document" tooltipPosition="top"></button>
              <span class="document-status success">Document disponible</span>
            </div>
            <div *ngIf="!pdfUrls[employe.id]" class="document-container">
              <i class="pi pi-times-circle" style="color: #ef4444;"></i>
              <span class="document-status error">Non disponible</span>
            </div>
          </td>
          
          <!-- Colonne Résultat (si formation validée) -->
          <td *ngIf="selectedFormation.valide">
            <div *ngIf="!employe.resultat" class="evaluation-form">
              <div class="radio-options">
                <div *ngFor="let option of resultatOptions" class="radio-option">
                  <p-radioButton [name]="'eval_'+employe.id" [value]="option.value" 
                               [(ngModel)]="employe.tempResultat"
                               (onClick)="updateResultat(selectedFormation.id, employe.id, option.value, employe)">
                  </p-radioButton>
                  <label (click)="updateResultat(selectedFormation.id, employe.id, option.value, employe)">
                    {{option.label}}
                  </label>
                </div>
              </div>
            </div>
            
            <div *ngIf="employe.resultat" class="evaluation-result">
              <p-tag [severity]="getSeverity(employe.resultat)" 
                     [value]="getResultatLabel(employe.resultat)"
                     styleClass="result-tag"></p-tag>
              <button pButton icon="pi pi-pencil" 
                      (click)="resetResultat(employe)"
                      class="p-button-rounded p-button-text edit-btn"
                      pTooltip="Modifier" tooltipPosition="left"></button>
            </div>
          </td>
        </tr>
      </ng-template>
      
      <ng-template pTemplate="emptymessage">
        <tr>
          <td [attr.colspan]="selectedFormation.valide ? 5 : 3">
            <div class="empty-state">
              <i class="pi pi-users" style="font-size: 2rem; color: #64748b;"></i>
              <p>Aucun participant trouvé pour cette formation</p>
            </div>
          </td>
        </tr>
      </ng-template>
    </p-table>
  </div>
</p-dialog>

<!-- Dialogue PDF modernisé -->
<p-dialog header="PDF Viewer" [(visible)]="displayPdfDialog" [modal]="true" [closable]="true" [style]="{ width: '80vw' }">
  <iframe *ngIf="pdfUrl" [src]="pdfUrl" width="100%" height="700px" style="border: 1px solid #ddd; border-radius: 4px;"></iframe>
</p-dialog>


<!-- Dialogue Affectation de poste modernisé -->
<p-dialog header="Affectation de poste" [(visible)]="displayPosteAssignmentDialog" [modal]="true" class="modern-dialog">
  <div class="dialog-content">
    <div class="p-fluid">
      <p>L'employé <strong>{{ selectedEmploye?.nom }} {{ selectedEmploye?.prenom }}</strong> 
        a réussi cette formation et va obtenir le poste <strong>{{ selectedPoste?.titre }}</strong>.</p>
        <p>Veuillez préciser dans quelle direction et sur quel site il exercera ce poste :</p> 
      
      <div class="p-field">
        <label>Direction</label>
        <p-dropdown [options]="directions" optionLabel="nom_direction"
                    [(ngModel)]="selectedDirection" (onChange)="onDirectionSelect($event)">
        </p-dropdown>
      </div>
      
      <div class="p-field">
        <label>Site</label>
        <p-dropdown [options]="sites" optionLabel="nom_site"
                    [(ngModel)]="selectedSite" [disabled]="!selectedDirection">
        </p-dropdown>
      </div>
      
      <div class="p-d-flex p-jc-end">
        <button pButton label="Confirmer" icon="pi pi-check"
                (click)="confirmAssignment()" [disabled]="!selectedDirection || !selectedSite">
        </button>
      </div>
    </div>
  </div>
</p-dialog>

<!-- Dialogue Création modernisé -->
<p-dialog header="Créer une Formation" [(visible)]="dialogVisible" 
[modal]="true" 
[closable]="false"
[style]="{ width: '900px', height: '900px' }" 
[contentStyle]="{ 'max-height': '700px', 'overflow-y': 'auto' }"
[responsive]="true"
[draggable]="false" 
[resizable]="false">
  <form [formGroup]="formationForm" (ngSubmit)="submitFormation()">
    <div class="dialog-content p-fluid">
      <!-- Champ Titre -->
      <div class="p-field">
        <label for="titre">Titre</label>
        <input pInputText id="titre" formControlName="titre" placeholder="Entrez le titre de la formation" />
        <br>
        <small *ngIf="formationForm.get('titre')?.invalid && formationForm.get('titre')?.touched" class="p-error">
          Le titre est obligatoire.
        </small>
      </div>
      <br>

     <!-- Champ Description avec p-inputTextarea -->
<div  class="p-field p-mb-3">
  <label for="description">Description</label>
  <textarea pInputTextarea id="description" formControlName="description" rows="5"
    placeholder="Entrez la description de la formation"></textarea>
    <br>
  <small *ngIf="formationForm.get('description')?.invalid && formationForm.get('description')?.touched" class="p-error">
    La description est obligatoire.
  </small>
</div>
<br>
<div class="date-container">
  <div class="p-field">
    <label for="sousTypeFormation">Sous-Type de Formation</label>
    <p-dropdown id="sousTypeFormation" formControlName="sousTypeFormation" [options]="sousTypeFormations"
    placeholder="Sélectionner un sous-type" [showClear]="true" [filter]="true" filterPlaceholder="Rechercher un sous-type"
    (onChange)="onSousTypeChange($event.value)">
  </p-dropdown>
    <br>
    <small *ngIf="formationForm.get('sousTypeFormation')?.invalid && formationForm.get('sousTypeFormation')?.touched" class="p-error">
      Le sous-type de formation est obligatoire.
    </small>
  </div>
</div>
      <!-- Champ Type de Formation -->
      <div class="p-field">
        <label for="typeFormation">Type de Formation</label>
        <p-dropdown id="typeFormation" formControlName="typeFormation" [options]="typeFormations"
        placeholder="Sélectionner un type" [showClear]="true" [filter]="true" filterPlaceholder="Rechercher un type"
        [disabled]="formationForm.get('typeFormation')?.disabled ?? false">
      </p-dropdown>
        <br>

        <small *ngIf="formationForm.get('typeFormation')?.invalid && formationForm.get('typeFormation')?.touched" class="p-error">
          Le type de formation est obligatoire.
        </small>
      </div>

      <!-- Champ Sous-Type de Formation -->
      
    <br>
      <div class="date-container">
        <!-- Champ Date de début -->
        <div class="p-field ">
          <label for="dateDebutPrevue">Date de début</label>
          <p-calendar
            id="dateDebutPrevue"
            formControlName="dateDebutPrevue"
            [showIcon]="true"
            dateFormat="dd/mm/yy"
            
           
          ></p-calendar>
          <br>
          <small
            *ngIf="formationForm.get('dateDebutPrevue')?.invalid && formationForm.get('dateDebutPrevue')?.touched"
            class="p-error"
          >
            La date de début est obligatoire.
          </small>
        </div>
      
        <!-- Champ Date de fin -->
        <div class="p-field">
          <label for="dateFinPrevue">Date de fin</label>
          <p-calendar
            id="dateFinPrevue"
            formControlName="dateFinPrevue"
            [showIcon]="true"
            dateFormat="dd/mm/yy"
          ></p-calendar>
          <br>
          <ng-container *ngIf="formationForm.get('dateFinPrevue')?.dirty">
            <small
              *ngIf="formationForm.get('dateFinPrevue')?.hasError('required')"
              class="p-error"
            >
              La date de fin est obligatoire.
            </small>
            <small
              *ngIf="formationForm.get('dateFinPrevue')?.hasError('dateInvalide') && !formationForm.get('dateFinPrevue')?.hasError('required')"
              class="p-error"
            >
              La date de fin doit être après la date de début.
            </small>
          </ng-container>
        </div>
      </div>
      <br>
      <!-- Champ Type de responsable -->
      <div class="date-container">
      <div class="p-field">
        <label for="responsableType">Type de responsable</label>
        <p-dropdown id="responsableType" formControlName="responsableType" [options]="['INTERNE', 'EXTERNE']"
        placeholder="Sélectionner un type de responsable" (onChange)="onResponsableTypeChange($event.value)"
        [showClear]="true" [disabled]="formationForm.get('responsableType')?.disabled ?? false">
      </p-dropdown>
        <br>
        <small *ngIf="formationForm.get('responsableType')?.invalid && formationForm.get('responsableType')?.touched" class="p-error">
          Le type de responsable est obligatoire.
        </small>
        <br>
        
      </div>

      <!-- Responsable Interne -->
      <div *ngIf="selectedResponsableType === 'INTERNE'">
        <div class="p-field">
          <label for="responsableEvaluationId">Responsable interne</label>
          <p-dropdown id="responsableEvaluationId" formControlName="responsableEvaluationId" [options]="responsables"
            optionLabel="nom" optionValue="id" placeholder="Sélectionner un responsable" [showClear]="true" [filter]="true"
            filterPlaceholder="Rechercher un responsable">
          </p-dropdown>
          <br>
          <small *ngIf="formationForm.get('responsableEvaluationId')?.invalid && formationForm.get('responsableEvaluationId')?.touched" class="p-error">
            Le responsable interne est obligatoire.
          </small>
        </div>
      </div>

      <!-- Responsable Externe -->
      <div *ngIf="selectedResponsableType === 'EXTERNE'">
        <div class="p-field">
          <label for="responsableEvaluationExterne">Responsable externe</label>
          <input pInputText id="responsableEvaluationExterne" formControlName="responsableEvaluationExterne"
            placeholder="Entrez le nom du responsable externe" />
            <br>
          <small *ngIf="formationForm.get('responsableEvaluationExterne')?.invalid && formationForm.get('responsableEvaluationExterne')?.touched" class="p-error">
            Le responsable externe est obligatoire.
          </small>
        </div>
      </div>
    </div>
    <br>
      <!-- Sélection des employés -->
      <div class="p-field">
        <label for="selectedCities">Sélectionner des employés</label>
        <p-multiselect [options]="cities" formControlName="selectedCities" placeholder="Sélectionner des employés"
          [maxSelectedLabels]="3" [filter]="true" filterPlaceholder="Rechercher un employé"
          optionLabel="name" optionValue="code">
        </p-multiselect>
      
        <div *ngIf="isPolycompetence() && selectedEmployees.length > 0" class="selected-employees">
          <h4>Employés sélectionnés</h4>
          <div *ngFor="let employee of selectedEmployees" class="employee-item">
            <span>{{ employee.name }} - Matricule: {{ employee.matricule }}</span>
      
            <span *ngIf="!selectedRadio[employee.code] || editingEmployee[employee.code]; else showResult"  class="radio-group">
              <label *ngFor="let option of resultatOptions">
                <input type="radio" [name]="'radio_' + employee.code" 
                       [value]="option.value" 
                       (change)="onRadioChange(employee.code, option.value)">
                {{ option.label }}
              </label>
            </span>
      
         
            

            <ng-template #showResult>
              <p-tag [severity]="getSeverity(selectedRadio[employee.code])" 
              [value]="getResultatLabel(selectedRadio[employee.code])">
       </p-tag>
                     <button type="button" pButton icon="pi pi-pencil" 
              class="p-button-rounded p-button-text" 
              (click)="editSelection(employee.code)">
      </button>

            </ng-template>

          </div>
        </div>
      
        <br>
        <small *ngIf="formationForm.get('selectedCities')?.invalid && formationForm.get('selectedCities')?.touched" class="p-error">
          La sélection des employés est obligatoire.
        </small>
      </div>
      
      
      <br>
      <!-- Sélection du poste -->
      <div class="p-field" *ngIf="shouldShowPosteSection()">
        <label for="poste">Poste</label>
        <p-dropdown id="poste" [options]="postes" optionLabel="titre" formControlName="titrePoste" [(ngModel)]="posteSelectionne"
          placeholder="Sélectionner un poste" (onChange)="onPosteSelect($event)" [showClear]="true" [filter]="true"
          filterPlaceholder="Rechercher un poste">
        </p-dropdown>
        <br>
        <small *ngIf="formationForm.get('titrePoste')?.invalid && formationForm.get('titrePoste')?.touched" class="p-error">
          Le poste est obligatoire.
        </small>
      </div>

      <!-- Section PDF --> 
      <div class="p-field" *ngIf="shouldShowPosteSection()">
        <h4>Document PDF</h4>
        <p>Voici le document PDF associé au poste sélectionné :</p>
        <iframe id="pdfViewer" width="100%" height="400px" style="border: 1px solid #ddd; border-radius: 4px;"></iframe>
      </div>
    </div>
    <!-- Boutons -->
    
  </form>
  <ng-template pTemplate="footer">
    <button 
        pButton 
        pRipple 
        type="button" 
        label="Annuler" 
        icon="pi pi-times" 
        class="p-button-danger"
        (click)="closeDialog()"></button>
    <button 
        pButton 
        pRipple 
        type="button" 
        (click)="submitFormation()"
        label="submit" 
        icon="pi pi-check" 
        class="p-button-success"></button>
</ng-template>

</p-dialog>

<p-dialog
  header="Modifier la Formation"
  [(visible)]="displayModificationDialog"
  [modal]="true"
  [closable]="true"
  [style]="{ width: '900px', height: shouldShowPosteSectionModif() ? '800px' : '600px' }"
  [contentStyle]="{ 'max-height': '900px', 'overflow-y': 'auto' }"
  [responsive]="true"
>
  <form [formGroup]="modificationForm" (ngSubmit)="submitModificationForm()">
    <div class="p-fluid">
      <!-- Champ Titre -->
      <div class="p-field">
        <label for="titre">Titre</label>
        <input pInputText id="titre" formControlName="titre" placeholder="Entrez le titre de la formation" />
        <br>
        <small *ngIf="modificationForm.get('titre')?.invalid && modificationForm.get('titre')?.touched" class="p-error">
          Le titre est obligatoire.
        </small>
      </div>
      <br>

      <!-- Champ Description -->
      <div class="p-field p-mb-3">
        <label for="description">Description</label>
        <textarea pInputTextarea id="description" formControlName="description" rows="5" placeholder="Entrez la description de la formation"></textarea>
        <br>
        <small *ngIf="modificationForm.get('description')?.invalid && modificationForm.get('description')?.touched" class="p-error">
          La description est obligatoire.
        </small>
      </div>
      <br>
      
      <div class="date-container">
        <!-- Champ Type de Formation -->
        <div class="p-field">
          <label for="typeFormation">Type de Formation</label>
          <p-dropdown id="typeFormation" formControlName="typeFormation"
           [options]="typeFormations" placeholder="Sélectionner un type" [showClear]="true" [filter]="true" 
           filterPlaceholder="Rechercher un type" [disabled]="modificationForm.get('typeFormation')?.disabled ?? false"></p-dropdown>
          <br>
          <small *ngIf="modificationForm.get('typeFormation')?.invalid && modificationForm.get('typeFormation')?.touched" class="p-error">
            Le type de formation est obligatoire.
          </small>
        </div>

        <!-- Champ Sous-Type de Formation -->
        <div class="p-field">
          <label for="sousTypeFormation">Sous-Type de Formation</label>
          <p-dropdown id="sousTypeFormation" 
          (onChange)="onSousTypeChangeModif($event.value)" 
          formControlName="sousTypeFormation" 
          [options]="getFilteredSousTypes()" 
          placeholder="Sélectionner un sous-type" 
          [showClear]="true" 
          [filter]="true"
          filterPlaceholder="Rechercher un sous-type"
          [disabled]="$any(modificationForm.get('sousTypeFormation')).disabled">
</p-dropdown>
          <br>
          <small *ngIf="modificationForm.get('sousTypeFormation')?.invalid && modificationForm.get('sousTypeFormation')?.touched" class="p-error">
            Le sous-type de formation est obligatoire.
          </small>
        </div>
      </div>
      <br>

      <div class="date-container">
        <!-- Champ Date de début -->
        <div class="p-field">
          <label for="dateDebutPrevue">Date de début</label>
          <p-calendar
            id="dateDebutPrevue"
            formControlName="dateDebutPrevue"
            [showIcon]="true"
            dateFormat="dd/mm/yy"
          ></p-calendar>
          <br>
          <small *ngIf="modificationForm.get('dateDebutPrevue')?.invalid && modificationForm.get('dateDebutPrevue')?.touched" class="p-error">
            La date de début est obligatoire.
          </small>
        </div>
      
        <!-- Champ Date de fin -->
        <div class="p-field">
          <label for="dateFinPrevue">Date de fin</label>
          <p-calendar
            id="dateFinPrevue"
            formControlName="dateFinPrevue"
            [showIcon]="true"
            dateFormat="dd/mm/yy"
          ></p-calendar>
          <br>
          <ng-container *ngIf="modificationForm.get('dateFinPrevue')?.dirty">
            <small
              *ngIf="modificationForm.get('dateFinPrevue')?.hasError('required')"
              class="p-error"
            >
              La date de fin est obligatoire.
            </small>
            <small
              *ngIf="modificationForm.get('dateFinPrevue')?.hasError('dateInvalide') && !modificationForm.get('dateFinPrevue')?.hasError('required')"
              class="p-error"
            >
              La date de fin doit être après la date de début.
            </small>
          </ng-container>
        </div>
      </div>
      <br>

      <!-- Champ Responsable d'évaluation -->
      <div class="date-container">
        <div class="p-field">
          <label for="responsableType">Type de responsable</label>
          <p-dropdown id="responsableType" formControlName="responsableType" [options]="['INTERNE', 'EXTERNE']"  [(ngModel)]="selectedResponsableTypeModif" 
            placeholder="Sélectionner un type de responsable" (onChange)="onResponsableTypeChangeModif($event.value)"
            [showClear]="true" [disabled]="modificationForm.get('responsableType')?.disabled ?? false">
          </p-dropdown>
          <br>
          <small *ngIf="modificationForm.get('responsableType')?.invalid && modificationForm.get('responsableType')?.touched" class="p-error">
            Le type de responsable est obligatoire.
          </small>
        </div>

        <!-- Responsable Interne -->
        <div *ngIf="selectedResponsableTypeModif === 'INTERNE'">
          <div class="p-field">
            <label for="responsableEvaluationId">Responsable interne</label>
            <p-dropdown id="responsableEvaluationId" formControlName="responsableEvaluationId" [options]="responsables"
              optionLabel="nom" optionValue="id" placeholder="Sélectionner un responsable" [showClear]="true" [filter]="true"
              filterPlaceholder="Rechercher un responsable">
            </p-dropdown>
            <br>
            <small *ngIf="modificationForm.get('responsableEvaluationId')?.invalid && modificationForm.get('responsableEvaluationId')?.touched" class="p-error">
              Le responsable interne est obligatoire.
            </small>
          </div>
        </div>

        <!-- Responsable Externe -->
        <div *ngIf="selectedResponsableTypeModif === 'EXTERNE'">
          <div class="p-field">
            <label for="responsableEvaluationExterne">Responsable externe</label>
            <input pInputText id="responsableEvaluationExterne" formControlName="responsableEvaluationExterne"
              placeholder="Entrez le nom du responsable externe" />
            <br>
            <small *ngIf="modificationForm.get('responsableEvaluationExterne')?.invalid && modificationForm.get('responsableEvaluationExterne')?.touched" class="p-error">
              Le responsable externe est obligatoire.
            </small>
          </div>
        </div>
      </div>
      <br>

      <!-- Section employés pour POLYCOMPETENCE -->
      <div class="p-field">
        <label for="selectedCitiesModif">Participants</label>
        <p-multiselect 
          [options]="cities" 
          formControlName="selectedCitiesModif" 
          placeholder="Sélectionner des employés"
          [maxSelectedLabels]="3" 
          [filter]="true" 
          filterPlaceholder="Rechercher un employé"
          optionLabel="name" 
          optionValue="code"
          (onChange)="onEmployeSelectionChangeModif($event.value)">
        </p-multiselect>
      
        <!-- Liste des employés sélectionnés (tous types) -->
        <div *ngIf="selectedEmployeesModif.length > 0" class="selected-employees">
          <h4>Participants sélectionnés</h4>
          <div *ngFor="let employee of selectedEmployeesModif" class="employee-item">
            <span>{{ employee.name }} - Matricule: {{ employee.matricule }}</span>
      
            <!-- Section résultats (uniquement pour POLYCOMPETENCE) -->
            <ng-container *ngIf="isPolycompetenceModif()">
              <span *ngIf="!selectedRadioModif[employee.code] || editingEmployeeModif[employee.code]; else showResultModif" class="radio-group">
                <label *ngFor="let option of resultatOptions">
                  <input type="radio" 
                         [name]="'radio_' + employee.code" 
                         [value]="option.value" 
                         [checked]="selectedRadioModif[employee.code] === option.value"
                         (change)="onRadioChangeModif(employee.code, option.value)">
                  {{ option.label }}
                </label>
              </span>
      
              <ng-template #showResultModif>
                <p-tag [severity]="getSeverity(selectedRadioModif[employee.code])" 
                       [value]="getResultatLabel(selectedRadioModif[employee.code])">
                </p-tag>
                <button type="button" pButton icon="pi pi-pencil" 
                        class="p-button-rounded p-button-text" 
                        (click)="editSelectionModif(employee.code)">
                </button>
              </ng-template>
            </ng-container>
          </div>
        </div>
      </div>
      <!-- Section Poste et PDF - seulement si ce n'est pas POLYCOMPETENCE -->
      <div *ngIf="shouldShowPosteSectionModif()">
        <!-- Champ Poste -->
        <div class="p-field">
          <label for="poste">Poste</label>
          <p-dropdown id="poste" [options]="postes" optionLabel="titre" formControlName="titrePoste" 
            placeholder="Sélectionner un poste" (onChange)="onPosteSelectModification($event)">
          </p-dropdown>
          <br>
          <small *ngIf="modificationForm.get('titrePoste')?.invalid && modificationForm.get('titrePoste')?.touched" class="p-error">
            Le poste est obligatoire.
          </small>
        </div>
        <br>

        <!-- Section PDF -->
        <div class="p-field">
          <h4>Document PDF</h4>
          <p>Voici le document PDF associé au poste sélectionné :</p>
          <iframe [src]="pdfUrl" width="100%" height="400px" style="border: 1px solid #ddd; border-radius: 4px;"></iframe>
        </div>
      </div>
    </div>

    <!-- Boutons -->
    
  </form>
  <ng-template pTemplate="footer">
    <button 
        pButton 
        pRipple 
        type="button" 
        label="Annuler" 
        icon="pi pi-times" 
        class="p-button-danger"
        (click)="closeModificationDialog()"></button>
    <button 
        pButton 
        pRipple 
        type="button" 
        (click)="submitModificationForm()"
        label="submit" 
        icon="pi pi-check" 
        class="p-button-success"></button>
</ng-template>
  <p-toast></p-toast>
</p-dialog>
<p-toast position="top-right"></p-toast>
<p-confirmDialog header="Confirmation" icon="pi pi-exclamation-triangle"
  [style]="{ width: '450px' }" acceptLabel="Oui" rejectLabel="Non"></p-confirmDialog>
  <p-confirmDialog></p-confirmDialog>
</body>
</html>